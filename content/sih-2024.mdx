---
title: "Smart India Hackathon 2024"
publishedAt: "2024-08-08"
summary: "Our official entry of the sih 2024, a geoloaction based attendance tracking app built for GAIL."
---

### Comprehensive Report on the Geolocation-Based Attendance Tracking App

---

## Introduction

The Geolocation-Based Attendance Tracking App is designed to streamline and automate the attendance tracking process for employees across multiple office locations. This app leverages geolocation technology to record employee check-in and check-out times, ensuring accurate and efficient attendance management. The app will be developed as a Progressive Web App (PWA) and will be converted into a Trusted Web Activity (TWA) to run seamlessly on Android and web platforms using a single codebase. This report provides a detailed explanation of the app’s functions, including the use of Google Maps API for geolocation, the implementation of geofencing, backend development, and API creation.

---

## 1. **Google Maps API and Geofencing**

### 1.1 **Overview**

The Google Maps API provides tools and services to integrate maps and geolocation services into web and mobile applications. For the attendance tracking app, the API will be used to determine the employee’s location, set up geofencing around office premises, and suggest nearby locations for manual check-ins.

### 1.2 **Setting Up Google Maps API**

1. **Create a Google Cloud Project:**
   - Go to the [Google Cloud Console](https://console.cloud.google.com/).
   - Create a new project or select an existing project.

2. **Enable the Maps API:**
   - Navigate to `APIs & Services > Library`.
   - Enable the following APIs:
     - Maps JavaScript API
     - Geocoding API (for address lookup)
     - Geolocation API (for determining the user's location)
     - Places API (for location suggestions)

3. **Get an API Key:**
   - Go to `APIs & Services > Credentials`.
   - Click on `Create Credentials` and select `API Key`.
   - Restrict the API key to specific APIs and platforms for security.

4. **Integrate Google Maps in the App:**
   - Install the Google Maps JavaScript API in your React project:
     ```bash
     npm install @react-google-maps/api
     ```
   - Load the Google Maps API in your app:
     ```javascript
     import { LoadScript, GoogleMap } from '@react-google-maps/api';

     function MyMapComponent() {
       return (
         <LoadScript googleMapsApiKey="YOUR_API_KEY">
           <GoogleMap
             mapContainerStyle={{ width: '100%', height: '400px' }}
             center={{ lat: -3.745, lng: -38.523 }}
             zoom={10}
           />
         </LoadScript>
       );
     }
     ```

### 1.3 **Implementing Geofencing**

Geofencing is a technique used to create a virtual boundary around a specific geographic area. When an employee enters or exits this boundary, certain actions are triggered, such as checking in or out.

#### **Steps to Implement Geofencing:**

1. **Define the Office Location and Radius:**
   - Store the latitude and longitude of each office location in the database.
   - Set a radius of 200 meters around the office location.

2. **Check Employee's Location:**
   - Use the Geolocation API to get the employee's current location:
     ```javascript
     navigator.geolocation.getCurrentPosition(
       (position) => {
         const { latitude, longitude } = position.coords;
         // Use these coordinates to check geofence
       },
       (error) => {
         console.error('Error getting location:', error);
       }
     );
     ```

3. **Calculate Distance from Office:**
   - Calculate the distance between the employee's current location and the office location using the Haversine formula:
     ```javascript
     function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
       const R = 6371; // Radius of the earth in km
       const dLat = deg2rad(lat2 - lat1);  // deg2rad below
       const dLon = deg2rad(lon2 - lon1); 
       const a = 
         Math.sin(dLat/2) * Math.sin(dLat/2) +
         Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
         Math.sin(dLon/2) * Math.sin(dLon/2)
         ; 
       const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
       const distance = R * c; // Distance in km
       return distance;
     }

     function deg2rad(deg) {
       return deg * (Math.PI/180);
     }
     ```

4. **Trigger Actions Based on Geofence:**
   - If the employee is within the 200-meter radius, trigger a check-in event.
   - If the employee exits the radius, trigger a check-out event.
   - Ensure that each check-in has a corresponding check-out.

### 1.4 **Manual Location Check-In/Check-Out**

For offsite work, the app allows manual check-ins/check-outs. The Places API can be used to suggest nearby locations based on the employee's current geolocation.

#### **Steps:**
- Use the `PlacesService` class to find places near the user's location:
  ```javascript
  const service = new window.google.maps.places.PlacesService(map);
  const request = {
    location: new window.google.maps.LatLng(lat, lng),
    radius: '500',
    type: ['establishment']
  };
  service.nearbySearch(request, callback);

  function callback(results, status) {
    if (status === window.google.maps.places.PlacesServiceStatus.OK) {
      for (let i = 0; i < results.length; i++) {
        // Display or use the suggested location
      }
    }
  }
  ```

---

## 2. **Backend Development**

The backend of the app will be developed using Node.js and Express.js. It will handle user authentication, store attendance records, and provide APIs for the frontend to interact with.

### 2.1 **Setting Up the Backend**

1. **Initialize the Project:**
   - Create a new Node.js project:
     ```bash
     npm init -y
     ```
   - Install necessary dependencies:
     ```bash
     npm install express mongoose jsonwebtoken bcryptjs dotenv
     ```

2. **Create the Server:**
   - Set up an Express.js server:
     ```javascript
     const express = require('express');
     const mongoose = require('mongoose');
     const dotenv = require('dotenv');

     dotenv.config();

     const app = express();
     app.use(express.json());

     mongoose.connect(process.env.MONGO_URI, {
       useNewUrlParser: true,
       useUnifiedTopology: true
     }).then(() => console.log('MongoDB connected'))
       .catch(err => console.error(err));

     app.listen(5000, () => console.log('Server running on port 5000'));
     ```

### 2.2 **Database Schema Design**

The MongoDB database will store user data, office locations, and attendance records.

1. **User Schema:**
   - Store user information, including encrypted passwords:
     ```javascript
     const mongoose = require('mongoose');
     const bcrypt = require('bcryptjs');

     const UserSchema = new mongoose.Schema({
       name: String,
       email: { type: String, unique: true },
       password: String,
       officeLocation: {
         lat: Number,
         lng: Number
       },
       role: { type: String, default: 'employee' }
     });

     UserSchema.pre('save', async function (next) {
       if (!this.isModified('password')) return next();
       const salt = await bcrypt.genSalt(10);
       this.password = await bcrypt.hash(this.password, salt);
       next();
     });

     module.exports = mongoose.model('User', UserSchema);
     ```

2. **Attendance Schema:**
   - Store attendance records with check-in/check-out times and locations:
     ```javascript
     const mongoose = require('mongoose');

     const AttendanceSchema = new mongoose.Schema({
       userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
       checkInTime: Date,
       checkOutTime: Date,
       location: {
         lat: Number,
         lng: Number
       },
       manualEntry: { type: Boolean, default: false }
     });

     module.exports = mongoose.model('Attendance', AttendanceSchema);
     ```

### 2.3 **API Development**

The backend will expose several RESTful APIs to interact with the frontend. These APIs will be secured using JSON Web Tokens (JWT) for authentication.

1. **User Authentication API:**

   - **Register:**
     ```javascript
     app.post('/api/register', async (req, res) => {
       try {
         const { name, email, password } = req.body;
         let user = await User.findOne({ email });
         if (user) return res.status(400).json({ msg: 'User already exists' });

         user = new User({ name, email, password });
         await user.save();

         const token = jwt.sign({ userId: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });
         res.json({ token });
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });
     ```

   - **Login:**
     ```javascript
     app.post('/api/login', async (req, res) => {
       try {
         const { email, password } = req.body;
         const user = await User.findOne({ email });
         if (!user) return res.status(400).json({ msg: 'Invalid credentials' });

         const isMatch = await bcrypt.compare(password, user.password);
         
         if (!isMatch) return res.status(400).json({ msg: 'Invalid credentials' });

         const token = jwt.sign({ userId: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });
         res.json({ token });
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });

     ```

2. **Attendance API:**

   - **Check-In:**
     ```javascript
     app.post('/api/attendance/check-in', authMiddleware, async (req, res) => {
       try {
         const { lat, lng } = req.body;
         const attendance = new Attendance({
           userId: req.user.userId,
           checkInTime: new Date(),
           location: { lat, lng }
         });
         await attendance.save();
         res.json(attendance);
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });
     ```

   - **Check-Out:**
     ```javascript
     app.post('/api/attendance/check-out', authMiddleware, async (req, res) => {
       try {
         const { lat, lng } = req.body;
         const attendance = await Attendance.findOne({ userId: req.user.userId, checkOutTime: null });
         if (!attendance) return res.status(400).json({ msg: 'No active check-in found' });

         attendance.checkOutTime = new Date();
         attendance.location = { lat, lng };
         await attendance.save();
         res.json(attendance);
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });
     ```

   - **Get Attendance Records:**
     ```javascript
     app.get('/api/attendance', authMiddleware, async (req, res) => {
       try {
         const records = await Attendance.find({ userId: req.user.userId }).sort({ checkInTime: -1 });
         res.json(records);
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });
     ```

3. **Working Hours Calculation API:**

   - **Calculate Working Hours:**
     ```javascript
     app.get('/api/attendance/hours', authMiddleware, async (req, res) => {
       try {
         const records = await Attendance.find({ userId: req.user.userId, checkOutTime: { $ne: null } });
         let totalHours = 0;
         records.forEach(record => {
           const hours = (new Date(record.checkOutTime) - new Date(record.checkInTime)) / 36e5;
           totalHours += hours;
         });
         res.json({ totalHours });
       } catch (err) {
         res.status(500).json({ msg: 'Server error' });
       }
     });
     ```

### 2.4 **Middleware for Authentication**

Implement a middleware function to protect certain routes, ensuring only authenticated users can access them.

```javascript
const jwt = require('jsonwebtoken');

function authMiddleware(req, res, next) {
  const token = req.header('Authorization').replace('Bearer ', '');
  if (!token) return res.status(401).json({ msg: 'No token, authorization denied' });

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    res.status(401).json({ msg: 'Token is not valid' });
  }
}
```

---

## 3. **Frontend Integration**

### 3.1 **React Components**

1. **Check-In/Check-Out Button:**
   - This button will display the employee's current status (checked in or out) and allow them to check in or out with a single tap.
   - It will trigger the corresponding API call and update the status in real-time.

2. **Map Component:**
   - Display the user's current location on a map.
   - Show the geofence boundary around the office location.

3. **Attendance History:**
   - Display a list of check-in and check-out times along with the location on each day.
   - Allow filtering by date or location.

4. **Profile and Settings:**
   - Provide options for users to update their profile, change their office location radius, and configure notification preferences.

### 3.2 **PWA and TWA Implementation**

1. **PWA Features:**
   - **Offline Support:** Use service workers to cache assets and allow the app to work offline.
   - **Push Notifications:** Implement push notifications to remind employees to check in or out.
   - **Add to Home Screen:** Allow users to add the app to their home screen with a custom icon and launch it in full-screen mode.

2. **TWA Conversion:**
   - **TWA Wrapper:** Convert the PWA into a TWA using Android Studio or a tool like `bubblewrap`.
   - **Integration with Android Features:** Utilize Android's native capabilities, such as handling geolocation permissions and notifications, for a seamless user experience.

---

## Conclusion

This comprehensive report covers the detailed design, implementation, and integration of a geolocation-based attendance tracking app. By leveraging Google Maps API, implementing geofencing, developing a robust backend with Node.js and Express.js, and integrating these features into a PWA/TWA, the app will provide an efficient and accurate system for tracking employee attendance. This system ensures data accuracy and offers a user-friendly interface, meeting the needs of the Delhi government for an automated attendance management system.